---
title: "Analise RAIS"
output: html_document
---

```{r}
#Pacotes utilizados nesta analise:
library(bigrquery)
library(dplyr)
library(ggplot2)

```

#Conectando
Conectando com o datalake da Base dos Dados:

```{r}
conexao <- bigrquery::dbConnect(
  bigrquery::bigquery(),
  project = "basedosdados",
  dataset = "br_me_rais",
  billing = "rais-pmsb"
)

bigrquery::bq_auth("pedrobarrosrjsp@gmail.com")

cbo_2002_cd <- c("252515", "252525", "211110",
                 "211205", "211210", "411035",
                 "211210", "131120", "211215")

microdados_cd_2013up <- tbl(conexao, "microdados_vinculos") |>
  select(everything()) |>
   filter(
     ano >= 2013,
     ano <= 2021,
     cbo_2002 %in% cbo_2002_cd
   )

microdados_cd_2013up <- collect(microdados_cd_2013up)

microdados_cd_2013up |>
  readr::write_rds(
    "~/ProjetosR/portfolio_pedro/data/microdados_cd_2013up.rds",
    compress = "xz"
  )

```

#Perguntas de pesquisa:

Pergunta ampla:
1. Quando ganha uma pessoa que trabalha com ciência de dados?

Perguntas específicas:
1. Como o valor varia ao longo dos anos?
1. Como o valor varia regionalmente?
1. Como o valor varia em relação às características pessoais?
    1. Gênero;
    1. Raça;
    1. Idade.
1. Há algum setor da economia (CNAE) em que as contratações estão acelerando?
1. Em qual setor da economia (CNAE) os cientistas de dados ganham mais?

Escopo:
CBO_2002:
Ano: a partir de 2013, pois antes disso é difícil de falar em "cientista de dados" antes disso.

Gráfico e tabela de remuneração média anual:
```{r}

#Remuneração média por ano:
tabela_remun_med_anual <- microdados_cd_2013up |>
  group_by(ano) |>
  summarise(remun_med = mean(valor_remuneracao_media))

tabela_remun_med_anual |>
  ggplot(aes(x = ano, y = remun_med))+
  geom_col()+
  scale_x_continuous(breaks = 2013:2021)

knitr::kable(tabela_remun_med_anual)

```

